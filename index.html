<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Quiz - My Life, My Quiz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        .quiz-creator {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .creator-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .creator-header h1 {
            color: #ff6b6b;
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #ffd166;
        }
        
        .creator-header p {
            font-size: 1.2rem;
            color: #6c757d;
        }
        
        .back-to-quizzes {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: linear-gradient(to bottom, #6a11cb, #2575fc);
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
        }
        
        .quiz-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .form-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .form-section h3 {
            color: #118ab2;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #a8dadc;
        }
        
        .questions-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ced4da;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="quiz-creator">
            <a href="index.html" class="back-to-quizzes">
                <i class="fas fa-arrow-left"></i> Back to Quizzes
            </a>
            
            <div class="creator-header">
                <h1>Create Your Quiz</h1>
                <p>Design your custom quiz with multiple levels and media-rich questions</p>
            </div>
            
            <div class="quiz-form">
                <div class="form-section">
                    <h3>Quiz Information</h3>
                    <div class="form-group">
                        <label for="quiz-name">Quiz Name</label>
                        <input type="text" id="quiz-name" placeholder="Enter a name for your quiz">
                    </div>
                    <button id="save-quiz-name-btn" class="admin-btn">
                        <i class="fas fa-save"></i> Save Quiz Name
                    </button>
                </div>
                
                <div class="form-section">
                    <h3>Level Management</h3>
                    <div class="level-form">
                        <div class="form-group">
                            <label for="level-name">Level Name</label>
                            <input type="text" id="level-name" placeholder="Enter level name">
                        </div>
                        <div class="form-group">
                            <label for="level-color1">Color 1</label>
                            <input type="color" id="level-color1" value="#6a11cb">
                        </div>
                        <div class="form-group">
                            <label for="level-color2">Color 2</label>
                            <input type="color" id="level-color2" value="#2575fc">
                        </div>
                        <button id="add-level-btn" class="admin-btn">
                            <i class="fas fa-plus"></i> Add Level
                        </button>
                    </div>
                    
                    <div id="level-list" class="level-list">
                        <!-- Levels will be added here -->
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Add Questions</h3>
                    <div class="admin-form">
                        <div class="form-group full-width">
                            <label for="admin-difficulty">Select Level</label>
                            <select id="admin-difficulty">
                                <option value="">Select a level first</option>
                            </select>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="admin-question">Question</label>
                            <textarea id="admin-question" placeholder="Enter your question"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="admin-option1">Option 1 (Correct Answer)</label>
                            <input type="text" id="admin-option1" placeholder="Correct answer">
                        </div>
                        
                        <div class="form-group">
                            <label for="admin-option2">Option 2</label>
                            <input type="text" id="admin-option2" placeholder="Option 2">
                        </div>
                        
                        <div class="form-group">
                            <label for="admin-option3">Option 3</label>
                            <input type="text" id="admin-option3" placeholder="Option 3">
                        </div>
                        
                        <div class="form-group">
                            <label for="admin-option4">Option 4</label>
                            <input type="text" id="admin-option4" placeholder="Option 4">
                        </div>
                        
                        <div class="form-group full-width">
                            <label>Display Media (Optional)</label>
                            <div class="media-upload-section">
                                <div class="media-type-selector">
                                    <button class="media-type-btn active" data-type="image" data-for="display">
                                        <i class="fas fa-image"></i> Image
                                    </button>
                                    <button class="media-type-btn" data-type="video" data-for="display">
                                        <i class="fas fa-video"></i> Video
                                    </button>
                                </div>
                                <input type="file" id="display-media-upload" accept="image/*,video/*" style="display: none;">
                                <button type="button" class="data-btn" id="display-media-upload-btn" style="margin-bottom: 10px;">
                                    <i class="fas fa-upload"></i> Upload Media
                                </button>
                                <input type="text" id="display-media-url" placeholder="Or enter media URL">
                                <img id="display-media-preview" class="media-preview">
                                <video id="display-video-preview" class="media-preview" controls style="display: none;"></video>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label>After-Answer Media (Optional)</label>
                            <div class="media-upload-section">
                                <div class="media-type-selector">
                                    <button class="media-type-btn active" data-type="image" data-for="after">
                                        <i class="fas fa-image"></i> Image
                                    </button>
                                    <button class="media-type-btn" data-type="video" data-for="after">
                                        <i class="fas fa-video"></i> Video
                                    </button>
                                </div>
                                <input type="file" id="after-media-upload" accept="image/*,video/*" style="display: none;">
                                <button type="button" class="data-btn" id="after-media-upload-btn" style="margin-bottom: 10px;">
                                    <i class="fas fa-upload"></i> Upload Media
                                </button>
                                <input type="text" id="after-media-url" placeholder="Or enter media URL">
                                <img id="after-media-preview" class="media-preview">
                                <video id="after-video-preview" class="media-preview" controls style="display: none;"></video>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <button id="add-question-btn" class="admin-btn">
                                <i class="fas fa-plus-circle"></i> Add Question
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Current Questions</h3>
                    <div id="questions-list" class="questions-list">
                        <div class="empty-state">
                            <i class="fas fa-question-circle"></i>
                            <p>No questions added yet. Add questions using the form above.</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button id="save-quiz-btn" class="admin-btn" style="background: linear-gradient(to bottom, #06d6a0, #04a57a);">
                        <i class="fas fa-save"></i> Save Quiz
                    </button>
                    <button id="reset-questions-btn" class="admin-btn" style="background: linear-gradient(to bottom, #ef476f, #d90429);">
                        <i class="fas fa-trash"></i> Reset All
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for error messages -->
    <div class="modal" id="error-modal">
        <div class="modal-content">
            <h2><i class="fas fa-exclamation-circle"></i> Oops!</h2>
            <p id="modal-message">Please create some questions first.</p>
            <button class="modal-btn" id="modal-ok-btn">OK</button>
        </div>
    </div>

    <script>
        // Use a key for localStorage
        const STORAGE_KEY = 'mediaQuiz_Quizzes';
        
        // Default empty data structure
        const defaultData = {
            quizzes: []
        };

        // DOM elements
        const quizNameInput = document.getElementById('quiz-name');
        const saveQuizNameBtn = document.getElementById('save-quiz-name-btn');
        const saveQuizBtn = document.getElementById('save-quiz-btn');
        const levelSelect = document.getElementById('admin-difficulty');
        const levelNameInput = document.getElementById('level-name');
        const levelColor1Input = document.getElementById('level-color1');
        const levelColor2Input = document.getElementById('level-color2');
        const addLevelBtn = document.getElementById('add-level-btn');
        const levelList = document.getElementById('level-list');
        const addQuestionBtn = document.getElementById('add-question-btn');
        const resetQuestionsBtn = document.getElementById('reset-questions-btn');
        const questionsList = document.getElementById('questions-list');
        const errorModal = document.getElementById('error-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalOkBtn = document.getElementById('modal-ok-btn');
        const displayMediaUploadBtn = document.getElementById('display-media-upload-btn');
        const displayMediaUpload = document.getElementById('display-media-upload');
        const afterMediaUploadBtn = document.getElementById('after-media-upload-btn');
        const afterMediaUpload = document.getElementById('after-media-upload');

        // Quiz data
        let quizData = {};
        let currentQuiz = null;

        // Initialize the admin panel
        function initAdmin() {
            // Load quizzes from localStorage or use defaults
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                try {
                    quizData = JSON.parse(savedData);
                } catch (e) {
                    console.error("Error parsing saved data:", e);
                    quizData = JSON.parse(JSON.stringify(defaultData));
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
                }
            } else {
                quizData = JSON.parse(JSON.stringify(defaultData));
                localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
            }

            // Check if we're editing an existing quiz
            const urlParams = new URLSearchParams(window.location.search);
            const quizId = urlParams.get('quizId');
            
            if (quizId) {
                const quiz = quizData.quizzes.find(q => q.id === quizId);
                if (quiz) {
                    currentQuiz = quiz;
                    quizNameInput.value = quiz.name;
                    updateLevelSelect();
                    updateLevelList();
                    updateQuestionsList();
                }
            }

            // Event listeners
            saveQuizNameBtn.addEventListener('click', saveQuizName);
            saveQuizBtn.addEventListener('click', saveQuiz);
            addQuestionBtn.addEventListener('click', addCustomQuestion);
            resetQuestionsBtn.addEventListener('click', resetQuestions);
            modalOkBtn.addEventListener('click', () => {
                errorModal.style.display = 'none';
            });
            
            // Level management
            addLevelBtn.addEventListener('click', addCustomLevel);
            
            // Media upload buttons
            displayMediaUploadBtn.addEventListener('click', () => displayMediaUpload.click());
            afterMediaUploadBtn.addEventListener('click', () => afterMediaUpload.click());
            
            // Media upload previews
            setupMediaUpload('display');
            setupMediaUpload('after');
            
            // Media type selector
            document.querySelectorAll('.media-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const forSection = this.getAttribute('data-for');
                    const container = this.parentElement;
                    
                    // Toggle active state
                    container.querySelectorAll('.media-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update preview visibility
                    if (forSection === 'display') {
                        if (type === 'image') {
                            document.getElementById('display-media-preview').style.display = 'block';
                            document.getElementById('display-video-preview').style.display = 'none';
                        } else {
                            document.getElementById('display-media-preview').style.display = 'none';
                            document.getElementById('display-video-preview').style.display = 'block';
                        }
                    } else {
                        if (type === 'image') {
                            document.getElementById('after-media-preview').style.display = 'block';
                            document.getElementById('after-video-preview').style.display = 'none';
                        } else {
                            document.getElementById('after-media-preview').style.display = 'none';
                            document.getElementById('after-video-preview').style.display = 'block';
                        }
                    }
                });
            });
        }

        function saveQuizName() {
            const name = quizNameInput.value.trim();
            
            if (!name) {
                showModal("Please enter a quiz name!");
                return;
            }
            
            // Create a simple ID for the quiz
            const id = name.toLowerCase().replace(/\s+/g, '-');
            
            // Check if quiz with this name already exists
            const existingQuiz = quizData.quizzes.find(q => q.id === id);
            
            if (existingQuiz) {
                // Use existing quiz
                currentQuiz = existingQuiz;
                showModal(`Editing existing quiz: "${name}"`);
            } else {
                // Create new quiz
                currentQuiz = {
                    id,
                    name,
                    levels: [],
                    questions: {}
                };
                quizData.quizzes.push(currentQuiz);
                showModal(`Quiz "${name}" created successfully!`);
            }
            
            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
            
            // Update UI
            updateLevelSelect();
            updateLevelList();
        }

        function saveQuiz() {
            if (!currentQuiz) {
                showModal("Please create a quiz first!");
                return;
            }
            
            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
            
            showModal(`Quiz "${currentQuiz.name}" saved successfully!`);
            
            // Redirect back to main page after a short delay
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1500);
        }

        function updateLevelSelect() {
            levelSelect.innerHTML = '';
            
            if (!currentQuiz || currentQuiz.levels.length === 0) {
                levelSelect.innerHTML = '<option value="">No levels available</option>';
                return;
            }
            
            currentQuiz.levels.forEach(level => {
                const option = document.createElement('option');
                option.value = level.id;
                option.textContent = level.name;
                levelSelect.appendChild(option);
            });
        }

        function updateLevelList() {
            levelList.innerHTML = '';
            
            if (!currentQuiz || currentQuiz.levels.length === 0) {
                levelList.innerHTML = '<p>No levels created yet</p>';
                return;
            }
            
            currentQuiz.levels.forEach((level, index) => {
                const levelItem = document.createElement('div');
                levelItem.classList.add('level-item');
                levelItem.style.background = `linear-gradient(to right, ${level.color1}, ${level.color2})`;
                
                const questionCount = currentQuiz.questions && currentQuiz.questions[level.id] ? 
                    currentQuiz.questions[level.id].length : 0;
                
                levelItem.innerHTML = `
                    <div>
                        <div>${level.name}</div>
                        <div class="level-order">Order: ${level.order}</div>
                        <small>${questionCount} question${questionCount !== 1 ? 's' : ''}</small>
                    </div>
                    <div class="level-actions">
                        <div class="level-order-controls">
                            <button class="order-btn" data-action="up" data-level="${level.id}" ${index === 0 ? 'disabled' : ''}>
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button class="order-btn" data-action="down" data-level="${level.id}" ${index === currentQuiz.levels.length - 1 ? 'disabled' : ''}>
                                <i class="fas fa-arrow-down"></i>
                            </button>
                        </div>
                        <button class="level-action-btn" data-action="edit" data-level="${level.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="level-action-btn" data-action="delete" data-level="${level.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                levelList.appendChild(levelItem);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.level-action-btn[data-action="delete"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const levelId = btn.getAttribute('data-level');
                    deleteLevel(levelId);
                });
            });
            
            document.querySelectorAll('.level-action-btn[data-action="edit"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const levelId = btn.getAttribute('data-level');
                    editLevel(levelId);
                });
            });
            
            // Add event listeners for order buttons
            document.querySelectorAll('.order-btn[data-action="up"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const levelId = btn.getAttribute('data-level');
                    moveLevelUp(levelId);
                });
            });
            
            document.querySelectorAll('.order-btn[data-action="down"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const levelId = btn.getAttribute('data-level');
                    moveLevelDown(levelId);
                });
            });
        }

        function updateQuestionsList() {
            questionsList.innerHTML = '';
            
            if (!currentQuiz) return;
            
            let hasQuestions = false;
            
            for (const level of currentQuiz.levels) {
                if (currentQuiz.questions && currentQuiz.questions[level.id] && currentQuiz.questions[level.id].length > 0) {
                    hasQuestions = true;
                    
                    const levelHeader = document.createElement('h3');
                    levelHeader.textContent = `Questions in ${level.name}`;
                    questionsList.appendChild(levelHeader);
                    
                    currentQuiz.questions[level.id].forEach((question, index) => {
                        const questionItem = document.createElement('div');
                        questionItem.classList.add('question-item');
                        
                        questionItem.innerHTML = `
                            <div class="question-text">${question.question}</div>
                            <div class="question-options">
                                <div class="question-option correct-option">âœ“ ${question.options[0]}</div>
                                <div class="question-option">${question.options[1]}</div>
                                <div class="question-option">${question.options[2]}</div>
                                <div class="question-option">${question.options[3]}</div>
                            </div>
                            <div class="question-actions">
                                <button class="edit-question-btn" data-level="${level.id}" data-index="${index}">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="delete-question-btn" data-level="${level.id}" data-index="${index}">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        `;
                        
                        questionsList.appendChild(questionItem);
                    });
                }
            }
            
            if (!hasQuestions) {
                questionsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-question-circle"></i>
                        <p>No questions added yet. Add questions using the form above.</p>
                    </div>
                `;
            } else {
                // Add event listeners to edit and delete buttons
                document.querySelectorAll('.edit-question-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const levelId = btn.getAttribute('data-level');
                        const index = parseInt(btn.getAttribute('data-index'));
                        editQuestion(levelId, index);
                    });
                });
                
                document.querySelectorAll('.delete-question-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const levelId = btn.getAttribute('data-level');
                        const index = parseInt(btn.getAttribute('data-index'));
                        deleteQuestion(levelId, index);
                    });
                });
            }
        }

        function showModal(message) {
            modalMessage.textContent = message;
            errorModal.style.display = 'flex';
        }

        function setupMediaUpload(section) {
            const uploadInput = document.getElementById(`${section}-media-upload`);
            const urlInput = document.getElementById(`${section}-media-url`);
            const imagePreview = document.getElementById(`${section}-media-preview`);
            const videoPreview = document.getElementById(`${section}-video-preview`);
            
            if (!uploadInput || !urlInput) return;
            
            uploadInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        if (file.type.startsWith('image/')) {
                            imagePreview.src = event.target.result;
                            imagePreview.style.display = 'block';
                            videoPreview.style.display = 'none';
                            // Set active button to image
                            document.querySelector(`.media-type-btn[data-for="${section}"][data-type="image"]`).classList.add('active');
                            document.querySelector(`.media-type-btn[data-for="${section}"][data-type="video"]`).classList.remove('active');
                        } else if (file.type.startsWith('video/')) {
                            videoPreview.src = event.target.result;
                            videoPreview.style.display = 'block';
                            imagePreview.style.display = 'none';
                            // Set active button to video
                            document.querySelector(`.media-type-btn[data-for="${section}"][data-type="video"]`).classList.add('active');
                            document.querySelector(`.media-type-btn[data-for="${section}"][data-type="image"]`).classList.remove('active');
                        }
                        urlInput.value = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            urlInput.addEventListener('input', function() {
                if (this.value) {
                    if (this.value.match(/\.(mp4|webm|ogg)$/i)) {
                        videoPreview.src = this.value;
                        videoPreview.style.display = 'block';
                        imagePreview.style.display = 'none';
                        // Set active button to video
                        document.querySelector(`.media-type-btn[data-for="${section}"][data-type="video"]`).classList.add('active');
                        document.querySelector(`.media-type-btn[data-for="${section}"][data-type="image"]`).classList.remove('active');
                    } else {
                        imagePreview.src = this.value;
                        imagePreview.style.display = 'block';
                        videoPreview.style.display = 'none';
                        // Set active button to image
                        document.querySelector(`.media-type-btn[data-for="${section}"][data-type="image"]`).classList.add('active');
                        document.querySelector(`.media-type-btn[data-for="${section}"][data-type="video"]`).classList.remove('active');
                    }
                } else {
                    // If URL is empty, hide previews
                    imagePreview.style.display = 'none';
                    videoPreview.style.display = 'none';
                }
            });
        }

        function addCustomLevel() {
            if (!currentQuiz) {
                showModal("Please create a quiz first!");
                return;
            }
            
            const name = levelNameInput.value.trim();
            const color1 = levelColor1Input.value;
            const color2 = levelColor2Input.value;
            
            if (!name) {
                showModal("Please enter a level name!");
                return;
            }
            
            // Create a simple ID for the level
            const id = `${currentQuiz.id}-${name.toLowerCase().replace(/\s+/g, '-')}`;
            
            // Check if level with this name already exists
            if (currentQuiz.levels.some(level => level.id === id)) {
                showModal("A level with this name already exists in this quiz!");
                return;
            }
            
            // Determine the order (next available)
            const order = currentQuiz.levels.length > 0 ? 
                Math.max(...currentQuiz.levels.map(l => l.order)) + 1 : 1;
            
            // Add the new level
            currentQuiz.levels.push({
                id,
                name,
                color1,
                color2,
                order
            });
            
            // Initialize empty questions array for this level
            if (!currentQuiz.questions) {
                currentQuiz.questions = {};
            }
            if (!currentQuiz.questions[id]) {
                currentQuiz.questions[id] = [];
            }
            
            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
            
            // Update UI
            updateLevelSelect();
            updateLevelList();
            
            // Reset form
            levelNameInput.value = '';
            
            showModal(`Level "${name}" created successfully!`);
        }

        function deleteLevel(levelId) {
            if (!confirm("Are you sure you want to delete this level? All questions in this level will also be deleted.")) {
                return;
            }
            
            // Remove level from levels array
            currentQuiz.levels = currentQuiz.levels.filter(level => level.id !== levelId);
            
            // Remove questions for this level
            if (currentQuiz.questions) {
                delete currentQuiz.questions[levelId];
            }
            
            // Reorder remaining levels
            currentQuiz.levels.forEach((level, index) => {
                level.order = index + 1;
            });
            
            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
            
            // Update UI
            updateLevelSelect();
            updateLevelList();
            updateQuestionsList();
            
            showModal("Level deleted successfully!");
        }

        function moveLevelUp(levelId) {
            const index = currentQuiz.levels.findIndex(level => level.id === levelId);
            if (index > 0) {
                // Swap levels
                [currentQuiz.levels[index], currentQuiz.levels[index - 1]] = 
                [currentQuiz.levels[index - 1], currentQuiz.levels[index]];
                
                // Update orders
                currentQuiz.levels[index].order = index + 1;
                currentQuiz.levels[index - 1].order = index;
                
                // Save to localStorage
                localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
                
                // Update UI
                updateLevelList();
            }
        }

        function moveLevelDown(levelId) {
            const index = currentQuiz.levels.findIndex(level => level.id === levelId);
            if (index < currentQuiz.levels.length - 1) {
                // Swap levels
                [currentQuiz.levels[index], currentQuiz.levels[index + 1]] = 
                [currentQuiz.levels[index + 1], currentQuiz.levels[index]];
                
                // Update orders
                currentQuiz.levels[index].order = index + 1;
                currentQuiz.levels[index + 1].order = index + 2;
                
                // Save to localStorage
                localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
                
                // Update UI
                updateLevelList();
            }
        }

        function editLevel(levelId) {
            // For simplicity, we'll just allow deletion and recreation
            // In a more advanced version, you could implement a proper edit form
            const level = currentQuiz.levels.find(l => l.id === levelId);
            if (level) {
                levelNameInput.value = level.name;
                levelColor1Input.value = level.color1;
                levelColor2Input.value = level.color2;
                
                // Delete the old level and create a new one when Add is clicked
                deleteLevel(levelId);
            }
        }

        function resetAdminForm() {
            // Reset all form fields
            document.getElementById('admin-question').value = '';
            document.getElementById('admin-option1').value = '';
            document.getElementById('admin-option2').value = '';
            document.getElementById('admin-option3').value = '';
            document.getElementById('admin-option4').value = '';
            
            // Reset media URLs
            document.getElementById('admin-display-media-url').value = '';
            document.getElementById('admin-after-media-url').value = '';
            
            // Reset file inputs
            document.getElementById('admin-display-media-upload').value = '';
            document.getElementById('admin-after-media-upload').value = '';
            
            // Reset previews
            document.getElementById('display-media-preview').style.display = 'none';
            document.getElementById('display-video-preview').style.display = 'none';
            document.getElementById('after-media-preview').style.display = 'none';
            document.getElementById('after-video-preview').style.display = 'none';
            
            // Reset media type buttons to image
            document.querySelectorAll('.media-type-btn').forEach(btn => {
                if (btn.getAttribute('data-type') === 'image') {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function addCustomQuestion() {
            if (!currentQuiz) {
                showModal("Please create a quiz first!");
                return;
            }
            
            const levelId = levelSelect.value;
            const questionText = document.getElementById('admin-question').value;
            const option1 = document.getElementById('admin-option1').value;
            const option2 = document.getElementById('admin-option2').value;
            const option3 = document.getElementById('admin-option3').value;
            const option4 = document.getElementById('admin-option4').value;
            
            // Get display media type and URL
            const displayMediaType = document.querySelector('.media-type-btn[data-for="display"].active').getAttribute('data-type');
            const displayMediaUrl = document.getElementById('admin-display-media-url').value;
            
            // Get after-answer media type and URL
            const afterMediaType = document.querySelector('.media-type-btn[data-for="after"].active').getAttribute('data-type');
            const afterMediaUrl = document.getElementById('admin-after-media-url').value;

            // Validate inputs
            if (!levelId) {
                showModal("Please select a level first!");
                return;
            }
            
            if (!questionText || !option1 || !option2 || !option3 || !option4) {
                showModal("Please fill in all question and answer fields!");
                return;
            }

            // Create new question object
            const newQuestion = {
                question: questionText,
                options: [option1, option2, option3, option4],
                correct: 0,
                displayMedia: displayMediaUrl ? {
                    type: displayMediaType,
                    url: displayMediaUrl
                } : null,
                afterMedia: afterMediaUrl ? {
                    type: afterMediaType,
                    url: afterMediaUrl
                } : null
            };

            // Add to questions
            if (!currentQuiz.questions) {
                currentQuiz.questions = {};
            }
            if (!currentQuiz.questions[levelId]) {
                currentQuiz.questions[levelId] = [];
            }
            currentQuiz.questions[levelId].push(newQuestion);

            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));

            // Reset the form
            resetAdminForm();

            // Update UI
            updateLevelList();
            updateQuestionsList();
            
            showModal(`Question added to level! The correct answer will be randomly positioned.`);
        }

        function resetQuestions() {
            if (confirm("Are you sure you want to reset all questions in this quiz? This cannot be undone.")) {
                currentQuiz.questions = {};
                localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
                
                // Update UI
                updateLevelList();
                updateQuestionsList();
                
                showModal("All questions have been reset!");
            }
        }

        // Initialize the admin panel
        initAdmin();
    </script>
</body>
</html>
