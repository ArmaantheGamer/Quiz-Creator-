<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Meme Quiz Creator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            color: #ff6b6b;
            font-size: 3.2rem;
            margin-bottom: 15px;
            text-shadow: 3px 3px 0 #ffd166;
            font-weight: 900;
        }
        
        h2 {
            color: #118ab2;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        h3 {
            color: #073b4c;
            margin: 15px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #a8dadc;
        }
        
        p {
            margin-bottom: 20px;
            font-size: 1.2rem;
            line-height: 1.5;
        }
        
        .difficulty-select {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .difficulty-btn {
            padding: 20px 30px;
            border: none;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .noob {
            background: linear-gradient(to bottom, #ffd166, #ffb700);
            color: #333;
        }
        
        .pro {
            background: linear-gradient(to bottom, #06d6a0, #04a57a);
            color: white;
        }
        
        .hacker {
            background: linear-gradient(to bottom, #ef476f, #d90429);
            color: white;
        }
        
        .disabled-btn {
            opacity: 0.6;
            cursor: not-allowed !important;
        }
        
        .difficulty-btn:hover:not(.disabled-btn) {
            transform: translateY(-8px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.3);
        }
        
        .difficulty-btn i {
            font-size: 2.5rem;
        }
        
        .quiz-container {
            display: none;
            text-align: left;
        }
        
        .question {
            font-size: 1.6rem;
            margin-bottom: 25px;
            color: #073b4c;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .meme-container {
            margin: 25px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            max-height: 350px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }
        
        .meme-container img, .meme-container video {
            width: 100%;
            height: auto;
            max-height: 350px;
            object-fit: contain;
        }
        
        .after-meme-container {
            display: none;
            margin: 25px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            max-height: 350px;
            justify-content: center;
            align-items: center;
            background: #000;
        }
        
        .after-meme-container img, .after-meme-container video {
            width: 100%;
            height: auto;
            max-height: 350px;
            object-fit: contain;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .options {
                grid-template-columns: 1fr;
            }
        }
        
        .option {
            padding: 20px;
            background: linear-gradient(to bottom, #f1faee, #e2f0e6);
            border: 3px solid #a8dadc;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .option:hover {
            background: linear-gradient(to bottom, #a8dadc, #8ecae6);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .selected {
            background: linear-gradient(to bottom, #ffb4a2, #ff9e8a);
            border-color: #e5989b;
        }
        
        .correct {
            background: linear-gradient(to bottom, #90ee90, #77dd77);
            border-color: #32cd32;
        }
        
        .incorrect {
            background: linear-gradient(to bottom, #ffcccb, #ffaaa9);
            border-color: #ff6b6b;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        .nav-btn {
            padding: 15px 30px;
            background: linear-gradient(to bottom, #118ab2, #0a6c8f);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-btn:hover {
            background: linear-gradient(to bottom, #073b4c, #052837);
            transform: scale(1.05);
        }
        
        .nav-btn:disabled {
            background: linear-gradient(to bottom, #ccc, #aaa);
            cursor: not-allowed;
            transform: none;
        }
        
        .score-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ef476f;
            background: #f8f9fa;
            padding: 10px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .result-container {
            display: none;
            text-align: center;
        }
        
        .result-title {
            font-size: 3rem;
            color: #06d6a0;
            margin-bottom: 30px;
            font-weight: 900;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .final-score {
            font-size: 5rem;
            color: #ef476f;
            margin: 30px 0;
            font-weight: 900;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .result-message {
            font-size: 1.8rem;
            margin-bottom: 40px;
            color: #073b4c;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .play-again {
            padding: 20px 50px;
            background: linear-gradient(to bottom, #ffd166, #ffb700);
            color: #333;
            border: none;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .play-again:hover {
            background: linear-gradient(to bottom, #ffb700, #ff9e00);
            transform: scale(1.08);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .progress-bar {
            height: 15px;
            background-color: #f1faee;
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1) inset;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #06d6a0, #04a57a);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .funny-message {
            font-style: italic;
            color: #6a11cb;
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        .level-indicator {
            font-size: 1.4rem;
            font-weight: bold;
            color: white;
            padding: 10px 25px;
            border-radius: 50px;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .admin-panel {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            text-align: left;
        }
        
        .admin-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #a8dadc;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .admin-btn {
            padding: 12px 25px;
            background: linear-gradient(to bottom, #118ab2, #0a6c8f);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .admin-btn:hover {
            background: linear-gradient(to bottom, #073b4c, #052837);
        }
        
        .toggle-admin {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: linear-gradient(to bottom, #6a11cb, #2575fc);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .toggle-admin:hover {
            background: linear-gradient(to bottom, #2575fc, #6a11cb);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        .meme-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 8px;
            display: none;
        }
        
        .meme-upload-section {
            border: 2px dashed #a8dadc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .meme-type-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .meme-type-btn {
            padding: 10px 15px;
            background: #e2f0e6;
            border: 2px solid #a8dadc;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .meme-type-btn.active {
            background: #a8dadc;
            border-color: #118ab2;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        
        .modal h2 {
            color: #ef476f;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .modal p {
            margin-bottom: 25px;
            font-size: 1.2rem;
        }
        
        .modal-btn {
            padding: 12px 25px;
            background: linear-gradient(to bottom, #118ab2, #0a6c8f);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .data-actions {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .data-btn {
            padding: 12px 20px;
            background: linear-gradient(to bottom, #6a11cb, #2575fc);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .instructions {
            background: #f1faee;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .instructions ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .level-manager {
            margin: 25px 0;
            padding: 20px;
            background: #e9f5db;
            border-radius: 15px;
        }
        
        .level-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .level-item {
            padding: 15px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .level-actions {
            display: flex;
            gap: 8px;
        }
        
        .level-action-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 5px;
            color: white;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .level-form {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 10px;
            align-items: end;
        }
        
        .color-preview {
            height: 40px;
            border-radius: 8px;
            border: 2px solid #ccc;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .difficulty-btn {
                min-width: 100%;
            }
            
            .question {
                font-size: 1.3rem;
            }
            
            .options {
                gap: 15px;
            }
            
            .option {
                padding: 15px;
                font-size: 1.1rem;
            }
            
            .nav-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .admin-form {
                grid-template-columns: 1fr;
            }
            
            .data-actions {
                flex-direction: column;
            }
            
            .level-form {
                grid-template-columns: 1fr;
            }
            
            .toggle-admin {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="toggle-admin" id="toggle-admin">
            <i class="fas fa-plus-circle"></i> Create your Quiz
        </button>
        
        <div id="start-screen">
            <h1>Meme Quiz Creator</h1>
            <h2>Create Your Own Quiz!</h2>
            <p>Add your own questions and memes to create a custom quiz experience!</p>
            
            <div class="instructions">
                <h3>How to use:</h3>
                <ul>
                    <li>Click the "Create your Quiz" button to add your own questions with memes</li>
                    <li>Create up to 5 custom levels with different colors</li>
                    <li>Upload images/videos or paste URLs for memes</li>
                    <li>Export your quiz data to share with others or use on different devices</li>
                    <li>Import quiz data to load questions created by others</li>
                </ul>
                <p><strong>Note:</strong> Videos may autoplay muted due to browser policies. Click the unmute button on videos if needed.</p>
            </div>
            
            <div class="data-actions">
                <button class="data-btn" id="export-btn">
                    <i class="fas fa-file-export"></i> Export Quiz Data
                </button>
                <button class="data-btn" id="import-btn">
                    <i class="fas fa-file-import"></i> Import Quiz Data
                </button>
                <input type="file" id="import-file" accept=".json" style="display: none;">
            </div>
            
            <div class="difficulty-select" id="level-buttons">
                <!-- Level buttons will be generated here -->
            </div>
            
            <p class="funny-message" id="start-message">No levels yet! Click 'Create your Quiz' to create levels and add questions.</p>
        </div>
        
        <div id="quiz-container" class="quiz-container">
            <div class="level-indicator" id="level-indicator"></div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="question" id="question"></div>
            
            <div class="meme-container" id="meme-container">
                <!-- Display meme will be inserted here -->
            </div>
            
            <div class="options" id="options"></div>
            
            <div class="after-meme-container" id="after-meme-container">
                <!-- After-answer meme will be inserted here -->
            </div>
            
            <div class="navigation">
                <button class="nav-btn" id="prev-btn" disabled><i class="fas fa-arrow-left"></i> Previous</button>
                <div class="score-display"><i class="fas fa-star"></i> Score: <span id="score">0</span></div>
                <button class="nav-btn" id="next-btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <div id="result-container" class="result-container">
            <h2 class="result-title">Quiz Completed!</h2>
            <div class="final-score" id="final-score">0</div>
            <p class="result-message" id="result-message"></p>
            <button class="play-again" id="play-again"><i class="fas fa-redo"></i> Play Again</button>
        </div>
        
        <div id="admin-panel" class="admin-panel">
            <h2>Quiz Creator Panel</h2>
            <p>Add your own questions and memes to the quiz! (Changes are saved to your browser's storage)</p>
            
            <div class="level-manager">
                <h3>Level Manager</h3>
                <p>Create up to 5 custom levels for your quiz</p>
                
                <div class="level-form">
                    <div class="form-group">
                        <label for="level-name">Level Name</label>
                        <input type="text" id="level-name" placeholder="Enter level name">
                    </div>
                    
                    <div class="form-group">
                        <label for="level-color1">Color 1</label>
                        <input type="color" id="level-color1" value="#ffd166">
                    </div>
                    
                    <div class="form-group">
                        <label for="level-color2">Color 2</label>
                        <input type="color" id="level-color2" value="#ffb700">
                    </div>
                    
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="admin-btn" id="add-level-btn"><i class="fas fa-plus"></i> Add Level</button>
                    </div>
                </div>
                
                <div class="level-list" id="level-list">
                    <!-- Levels will be listed here -->
                </div>
            </div>
            
            <div class="admin-form">
                <div class="form-group full-width">
                    <label for="admin-difficulty">Level</label>
                    <select id="admin-difficulty">
                        <!-- Levels will be populated here -->
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="admin-question">Question</label>
                    <input type="text" id="admin-question" placeholder="Enter your question here">
                </div>
                
                <div class="form-group">
                    <label for="admin-option1">Correct Answer</label>
                    <input type="text" id="admin-option1" placeholder="Correct answer">
                </div>
                
                <div class="form-group">
                    <label for="admin-option2">Option 2</label>
                    <input type="text" id="admin-option2" placeholder="Incorrect answer">
                </div>
                
                <div class="form-group">
                    <label for="admin-option3">Option 3</label>
                    <input type="text" id="admin-option3" placeholder="Incorrect answer">
                </div>
                
                <div class="form-group">
                    <label for="admin-option4">Option 4</label>
                    <input type="text" id="admin-option4" placeholder="Incorrect answer">
                </div>
                
                <div class="form-group full-width">
                    <h3>Display Meme (Shows with question)</h3>
                    <div class="meme-type-selector">
                        <button type="button" class="meme-type-btn active" data-type="image" data-for="display">Image</button>
                        <button type="button" class="meme-type-btn" data-type="video" data-for="display">Video</button>
                    </div>
                    <div class="meme-upload-section">
                        <input type="file" id="admin-display-meme-upload" accept="image/*,video/*">
                        <input type="text" id="admin-display-meme-url" placeholder="Or paste URL here">
                        <img id="display-meme-preview" class="meme-preview" alt="Meme preview">
                        <video id="display-video-preview" class="meme-preview" controls style="display:none"></video>
                    </div>
                </div>
                
                <div class="form-group full-width">
                    <h3>After-Answer Meme (Shows after answering)</h3>
                    <div class="meme-type-selector">
                        <button type="button" class="meme-type-btn active" data-type="image" data-for="after">Image</button>
                        <button type="button" class="meme-type-btn" data-type="video" data-for="after">Video</button>
                    </div>
                    <div class="meme-upload-section">
                        <input type="file" id="admin-after-meme-upload" accept="image/*,video/*">
                        <input type="text" id="admin-after-meme-url" placeholder="Or paste URL here">
                        <img id="after-meme-preview" class="meme-preview" alt="Meme preview">
                        <video id="after-video-preview" class="meme-preview" controls style="display:none"></video>
                    </div>
                </div>
                
                <div class="form-group full-width">
                    <button class="admin-btn" id="add-question-btn"><i class="fas fa-plus"></i> Add Question</button>
                    <button class="admin-btn" id="view-questions-btn" style="background: #06d6a0;"><i class="fas fa-eye"></i> View Questions</button>
                    <button class="admin-btn" id="reset-questions-btn" style="background: #ef476f;"><i class="fas fa-trash"></i> Reset All</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for error messages -->
    <div class="modal" id="error-modal">
        <div class="modal-content">
            <h2><i class="fas fa-exclamation-circle"></i> Oops!</h2>
            <p id="modal-message">Please create some questions first.</p>
            <button class="modal-btn" id="modal-ok-btn">OK</button>
        </div>
    </div>

    <script>
        // Use a key for localStorage
        const STORAGE_KEY = 'memeQuizQuestions_CustomLevels';
        
        // Default empty questions with custom levels
        const defaultData = {
            levels: [],
            questions: {}
        };

        // DOM elements
        const startScreen = document.getElementById('start-screen');
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        const questionElement = document.getElementById('question');
        const optionsElement = document.getElementById('options');
        const memeContainer = document.getElementById('meme-container');
        const afterMemeContainer = document.getElementById('after-meme-container');
        const scoreElement = document.getElementById('score');
        const finalScoreElement = document.getElementById('final-score');
        const resultMessageElement = document.getElementById('result-message');
        const progressElement = document.getElementById('progress');
        const prevButton = document.getElementById('prev-btn');
        const nextButton = document.getElementById('next-btn');
        const playAgainButton = document.getElementById('play-again');
        const startMessage = document.getElementById('start-message');
        const adminPanel = document.getElementById('admin-panel');
        const toggleAdminBtn = document.getElementById('toggle-admin');
        const addQuestionBtn = document.getElementById('add-question-btn');
        const resetQuestionsBtn = document.getElementById('reset-questions-btn');
        const viewQuestionsBtn = document.getElementById('view-questions-btn');
        const errorModal = document.getElementById('error-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalOkBtn = document.getElementById('modal-ok-btn');
        const exportBtn = document.getElementById('export-btn');
        const importBtn = document.getElementById('import-btn');
        const importFile = document.getElementById('import-file');
        const levelButtonsContainer = document.getElementById('level-buttons');
        const levelList = document.getElementById('level-list');
        const levelNameInput = document.getElementById('level-name');
        const levelColor1Input = document.getElementById('level-color1');
        const levelColor2Input = document.getElementById('level-color2');
        const addLevelBtn = document.getElementById('add-level-btn');
        const levelSelect = document.getElementById('admin-difficulty');

        // Quiz state
        let currentLevelId = '';
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let quizData = {};
        let questionShuffleMap = {};

        // Initialize the quiz
        function initQuiz() {
            // Load questions from localStorage or use defaults
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                quizData = JSON.parse(savedData);
            } else {
                quizData = JSON.parse(JSON.stringify(defaultData));
                localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
            }

            // Update UI based on questions
            updateLevelButtons();
            updateLevelSelect();
            updateLevelList();
            updateStartMessage();

            // Event listeners
            toggleAdminBtn.addEventListener('click', () => {
                if (adminPanel.style.display === 'block') {
                    adminPanel.style.display = 'none';
                    toggleAdminBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Create your Quiz';
                } else {
                    adminPanel.style.display = 'block';
                    toggleAdminBtn.innerHTML = '<i class="fas fa-times"></i> Close';
                }
            });

            addQuestionBtn.addEventListener('click', addCustomQuestion);
            resetQuestionsBtn.addEventListener('click', resetQuestions);
            viewQuestionsBtn.addEventListener('click', viewQuestions);
            modalOkBtn.addEventListener('click', () => {
                errorModal.style.display = 'none';
            });
            
            // Export/import functionality
            exportBtn.addEventListener('click', exportQuizData);
            importBtn.addEventListener('click', () => importFile.click());
            importFile.addEventListener('change', importQuizData);
            
            // Level management
            addLevelBtn.addEventListener('click', addCustomLevel);
            
            // Meme upload previews
            setupMemeUpload('display');
            setupMemeUpload('after');
            
            // Meme type selector
            document.querySelectorAll('.meme-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const forSection = this.getAttribute('data-for');
                    const container = this.parentElement;
                    
                    // Toggle active state
                    container.querySelectorAll('.meme-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update preview visibility
                    if (forSection === 'display') {
                        if (type === 'image') {
                            document.getElementById('display-meme-preview').style.display = 'block';
                            document.getElementById('display-video-preview').style.display = 'none';
                        } else {
                            document.getElementById('display-meme-preview').style.display = 'none';
                            document.getElementById('display-video-preview').style.display = 'block';
                        }
                    } else {
                        if (type === 'image') {
                            document.getElementById('after-meme-preview').style.display = 'block';
                            document.getElementById('after-video-preview').style.display = 'none';
                        } else {
                            document.getElementById('after-meme-preview').style.display = 'none';
                            document.getElementById('after-video-preview').style.display = 'block';
                        }
                    }
                });
            });
        }

        // Function to shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function updateLevelButtons() {
            levelButtonsContainer.innerHTML = '';
            
            if (quizData.levels.length === 0) {
                levelButtonsContainer.innerHTML = '<p>No levels created yet. Use the admin panel to create levels.</p>';
                return;
            }
            
            quizData.levels.forEach(level => {
                const button = document.createElement('button');
                button.classList.add('difficulty-btn');
                button.setAttribute('data-level', level.id);
                
                // Set gradient background
                button.style.background = `linear-gradient(to bottom, ${level.color1}, ${level.color2})`;
                
                // Set text color based on brightness of first color
                const color = hexToRgb(level.color1);
                const brightness = (color.r * 299 + color.g * 587 + color.b * 114) / 1000;
                button.style.color = brightness > 125 ? '#333' : 'white';
                
                button.innerHTML = `
                    <i class="fas fa-signal"></i>
                    ${level.name}
                `;
                
                // Check if level has questions
                if (!quizData.questions[level.id] || quizData.questions[level.id].length === 0) {
                    button.classList.add('disabled-btn');
                } else {
                    button.addEventListener('click', () => {
                        currentLevelId = level.id;
                        startQuiz();
                    });
                }
                
                levelButtonsContainer.appendChild(button);
            });
        }

        function updateLevelSelect() {
            levelSelect.innerHTML = '';
            
            if (quizData.levels.length === 0) {
                levelSelect.innerHTML = '<option value="">No levels available</option>';
                return;
            }
            
            quizData.levels.forEach(level => {
                const option = document.createElement('option');
                option.value = level.id;
                option.textContent = level.name;
                levelSelect.appendChild(option);
            });
        }

        function updateLevelList() {
            levelList.innerHTML = '';
            
            if (quizData.levels.length === 0) {
                levelList.innerHTML = '<p>No levels created yet</p>';
                return;
            }
            
            quizData.levels.forEach(level => {
                const levelItem = document.createElement('div');
                levelItem.classList.add('level-item');
                levelItem.style.background = `linear-gradient(to right, ${level.color1}, ${level.color2})`;
                
                const questionCount = quizData.questions[level.id] ? quizData.questions[level.id].length : 0;
                
                levelItem.innerHTML = `
                    <div>
                        <div>${level.name}</div>
                        <small>${questionCount} question${questionCount !== 1 ? 's' : ''}</small>
                    </div>
                    <div class="level-actions">
                        <button class="level-action-btn" data-action="edit" data-level="${level.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="level-action-btn" data-action="delete" data-level="${level.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                levelList.appendChild(levelItem);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.level-action-btn[data-action="delete"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const levelId = btn.getAttribute('data-level');
                    deleteLevel(levelId);
                });
            });
            
            document.querySelectorAll('.level-action-btn[data-action="edit"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const levelId = btn.getAttribute('data-level');
                    editLevel(levelId);
                });
            });
        }

        function updateStartMessage() {
            const totalQuestions = Object.values(quizData.questions).reduce((acc, curr) => acc + curr.length, 0);
            if (totalQuestions === 0) {
                startMessage.textContent = "No questions yet! Click 'Create your Quiz' to create levels and add questions.";
            } else {
                startMessage.textContent = "Select a level to start the quiz!";
            }
        }

        function showModal(message) {
            modalMessage.textContent = message;
            errorModal.style.display = 'flex';
        }

        function setupMemeUpload(section) {
            const uploadInput = document.getElementById(`admin-${section}-meme-upload`);
            const urlInput = document.getElementById(`admin-${section}-meme-url`);
            const imagePreview = document.getElementById(`${section}-meme-preview`);
            const videoPreview = document.getElementById(`${section}-video-preview`);
            
            uploadInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        if (file.type.startsWith('image/')) {
                            imagePreview.src = event.target.result;
                            imagePreview.style.display = 'block';
                            videoPreview.style.display = 'none';
                            // Set active button to image
                            document.querySelector(`.meme-type-btn[data-for="${section}"][data-type="image"]`).classList.add('active');
                            document.querySelector(`.meme-type-btn[data-for="${section}"][data-type="video"]`).classList.remove('active');
                        } else if (file.type.startsWith('video/')) {
                            videoPreview.src = event.target.result;
                            videoPreview.style.display = 'block';
                            imagePreview.style.display = 'none';
                            // Set active button to video
                            document.querySelector(`.meme-type-btn[data-for="${section}"][data-type="video"]`).classList.add('active');
                            document.querySelector(`.meme-type-btn[data-for="${section}"][data-type="image"]`).classList.remove('active');
                        }
                        urlInput.value = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            urlInput.addEventListener('input', function() {
                if (this.value) {
                    if (this.value.match(/\.(mp4|webm|ogg)$/i)) {
                        videoPreview.src = this.value;
                        videoPreview.style.display = 'block';
                        imagePreview.style.display = 'none';
                        // Set active button to video
                        document.querySelector(`.meme-type-btn[data-for="${section}"][data-type="video"]`).classList.add('active');
                        document.querySelector(`.meme-type-btn[data-for="${section}"][data-type="image"]`).classList.remove('active');
                    } else {
                        imagePreview.src = this.value;
                        imagePreview.style.display = 'block';
                        videoPreview.style.display = 'none';
                        // Set active button to image
                        document.querySelector(`.meme-type-btn[data-for="${section}"][data-type="image"]`).classList.add('active');
                        document.querySelector(`.meme-type-btn[data-for="${section}"][data-type="video"]`).classList.remove('active');
                    }
                }
            });
        }

        function addCustomLevel() {
            const name = levelNameInput.value.trim();
            const color1 = levelColor1Input.value;
            const color2 = levelColor2Input.value;
            
            if (!name) {
                showModal("Please enter a level name!");
                return;
            }
            
            if (quizData.levels.length >= 5) {
                showModal("You can only create up to 5 levels!");
                return;
            }
            
            // Create a simple ID for the level
            const id = name.toLowerCase().replace(/\s+/g, '-');
            
            // Check if level with this name already exists
            if (quizData.levels.some(level => level.id === id)) {
                showModal("A level with this name already exists!");
                return;
            }
            
            // Add the new level
            quizData.levels.push({
                id,
                name,
                color1,
                color2
            });
            
            // Initialize empty questions array for this level
            if (!quizData.questions[id]) {
                quizData.questions[id] = [];
            }
            
            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
            
            // Update UI
            updateLevelButtons();
            updateLevelSelect();
            updateLevelList();
            
            // Reset form
            levelNameInput.value = '';
            
            showModal(`Level "${name}" created successfully!`);
        }

        function deleteLevel(levelId) {
            if (!confirm("Are you sure you want to delete this level? All questions in this level will also be deleted.")) {
                return;
            }
            
            // Remove level from levels array
            quizData.levels = quizData.levels.filter(level => level.id !== levelId);
            
            // Remove questions for this level
            delete quizData.questions[levelId];
            
            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
            
            // Update UI
            updateLevelButtons();
            updateLevelSelect();
            updateLevelList();
            
            showModal("Level deleted successfully!");
        }

        function editLevel(levelId) {
            // For simplicity, we'll just allow deletion and recreation
            // In a more advanced version, you could implement a proper edit form
            const level = quizData.levels.find(l => l.id === levelId);
            if (level) {
                levelNameInput.value = level.name;
                levelColor1Input.value = level.color1;
                levelColor2Input.value = level.color2;
                
                // Delete the old level and create a new one when Add is clicked
                deleteLevel(levelId);
            }
        }

        function startQuiz() {
            // Double-check that we have questions
            if (!quizData.questions[currentLevelId] || quizData.questions[currentLevelId].length === 0) {
                showModal("No questions available for this level. Please add questions first.");
                return;
            }
            
            startScreen.style.display = 'none';
            quizContainer.style.display = 'block';
            resultContainer.style.display = 'none';
            adminPanel.style.display = 'none';
            toggleAdminBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Create your Quiz';
            
            currentQuestions = quizData.questions[currentLevelId];
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = new Array(currentQuestions.length).fill(null);
            
            scoreElement.textContent = score;
            
            // Set level indicator
            const currentLevel = quizData.levels.find(level => level.id === currentLevelId);
            if (currentLevel) {
                document.getElementById('level-indicator').textContent = currentLevel.name;
                document.getElementById('level-indicator').style.background = `linear-gradient(to right, ${currentLevel.color1}, ${currentLevel.color2})`;
            }
            
            showQuestion();
        }

        function showQuestion() {
            // Check if we have questions
            if (currentQuestions.length === 0 || currentQuestionIndex >= currentQuestions.length) {
                showModal("No questions available or invalid question index.");
                return;
            }
            
            const question = currentQuestions[currentQuestionIndex];
            questionElement.textContent = question.question;
            
            // Hide after-meme container
            afterMemeContainer.style.display = 'none';
            
            // Update progress bar
            progressElement.style.width = `${((currentQuestionIndex + 1) / currentQuestions.length) * 100}%`;
            
            // Display meme
            memeContainer.innerHTML = '';
            if (question.displayMeme && question.displayMeme.url) {
                if (question.displayMeme.type === 'image') {
                    const img = document.createElement('img');
                    img.src = question.displayMeme.url;
                    img.alt = "Question meme";
                    memeContainer.appendChild(img);
                } else {
                    const video = document.createElement('video');
                    video.src = question.displayMeme.url;
                    video.alt = "Question meme";
                    video.autoplay = true;
                    video.loop = true;
                    video.muted = true;
                    video.controls = true;
                    memeContainer.appendChild(video);
                }
            } else {
                memeContainer.innerHTML = '<p>No meme available</p>';
            }
            
            // Display options in shuffled order
            optionsElement.innerHTML = '';
            
            // Create a unique key for this question to remember its shuffle order
            const questionKey = `${currentLevelId}_${currentQuestionIndex}`;
            
            // If we haven't shuffled this question before, do it now
            if (!questionShuffleMap[questionKey]) {
                // Create a copy of the options array and shuffle it
                const shuffledOptions = shuffleArray([...question.options]);
                questionShuffleMap[questionKey] = {
                    options: shuffledOptions,
                    correctIndex: shuffledOptions.indexOf(question.options[0]) // Find where the correct answer ended up
                };
            }
            
            const shuffledData = questionShuffleMap[questionKey];
            
            shuffledData.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                if (userAnswers[currentQuestionIndex] === index) {
                    optionElement.classList.add('selected');
                }
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => selectOption(index, shuffledData.correctIndex));
                optionsElement.appendChild(optionElement);
            });
            
            // Update navigation buttons
            prevButton.disabled = currentQuestionIndex === 0;
            nextButton.textContent = currentQuestionIndex === currentQuestions.length - 1 ? 'Finish' : 'Next';
            nextButton.disabled = userAnswers[currentQuestionIndex] === null;
        }

        function selectOption(selectedIndex, correctIndex) {
            // If already answered this question, don't allow changing
            if (userAnswers[currentQuestionIndex] !== null) return;
            
            userAnswers[currentQuestionIndex] = selectedIndex;
            
            // Update visual selection
            const options = optionsElement.querySelectorAll('.option');
            options.forEach((option, index) =>{
                option.classList.remove('selected', 'correct', 'incorrect');
                if (index === selectedIndex) {
                    option.classList.add('selected');
                }
            });
            
            // Check if answer is correct
            if (selectedIndex === correctIndex) {
                score++;
                scoreElement.textContent = score;
                options[selectedIndex].classList.add('correct');
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[correctIndex].classList.add('correct');
            }
            
            // Show after-answer meme
            afterMemeContainer.innerHTML = '';
            const question = currentQuestions[currentQuestionIndex];
            if (question.afterMeme && question.afterMeme.url) {
                if (question.afterMeme.type === 'image') {
                    const img = document.createElement('img');
                    img.src = question.afterMeme.url;
                    img.alt = "Answer meme";
                    afterMemeContainer.appendChild(img);
                } else {
                    const video = document.createElement('video');
                    video.src = question.afterMeme.url;
                    video.alt = "Answer meme";
                    video.autoplay = true;
                    video.loop = true;
                    video.muted = true;
                    video.controls = true;
                    afterMemeContainer.appendChild(video);
                }
                afterMemeContainer.style.display = 'flex';
            }
            
            // Enable next button
            nextButton.disabled = false;
        }

        prevButton.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        });

        nextButton.addEventListener('click', () => {
            if (userAnswers[currentQuestionIndex] === null) {
                showModal("Please select an answer before proceeding!");
                return;
            }
            
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                finishQuiz();
            }
        });

        function finishQuiz() {
            quizContainer.style.display = 'none';
            resultContainer.style.display = 'block';
            
            finalScoreElement.textContent = `${score}/${currentQuestions.length}`;
            
            // Generate a result message based on score
            const percentage = score / currentQuestions.length;
            let message;
            
            if (percentage === 1) {
                message = "Perfect! You're a meme master!";
            } else if (percentage >= 0.8) {
                message = "Great job! You know your memes!";
            } else if (percentage >= 0.6) {
                message = "Good effort! Keep practicing!";
            } else if (percentage >= 0.4) {
                message = "Not bad, but room for improvement!";
            } else {
                message = "Better luck next time!";
            }
            
            resultMessageElement.textContent = message;
        }

        playAgainButton.addEventListener('click', () => {
            resultContainer.style.display = 'none';
            startScreen.style.display = 'block';
            // Clear the shuffle map when playing again
            questionShuffleMap = {};
        });

        function resetAdminForm() {
            // Reset all form fields
            document.getElementById('admin-question').value = '';
            document.getElementById('admin-option1').value = '';
            document.getElementById('admin-option2').value = '';
            document.getElementById('admin-option3').value = '';
            document.getElementById('admin-option4').value = '';
            
            // Reset meme URLs
            document.getElementById('admin-display-meme-url').value = '';
            document.getElementById('admin-after-meme-url').value = '';
            
            // Reset file inputs
            document.getElementById('admin-display-meme-upload').value = '';
            document.getElementById('admin-after-meme-upload').value = '';
            
            // Reset previews
            document.getElementById('display-meme-preview').style.display = 'none';
            document.getElementById('display-video-preview').style.display = 'none';
            document.getElementById('after-meme-preview').style.display = 'none';
            document.getElementById('after-video-preview').style.display = 'none';
            
            // Reset meme type buttons to image
            document.querySelectorAll('.meme-type-btn').forEach(btn => {
                if (btn.getAttribute('data-type') === 'image') {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function addCustomQuestion() {
            const levelId = levelSelect.value;
            const questionText = document.getElementById('admin-question').value;
            const option1 = document.getElementById('admin-option1').value;
            const option2 = document.getElementById('admin-option2').value;
            const option3 = document.getElementById('admin-option3').value;
            const option4 = document.getElementById('admin-option4').value;
            
            // Get display meme type and URL
            const displayMemeType = document.querySelector('.meme-type-btn[data-for="display"].active').getAttribute('data-type');
            const displayMemeUrl = document.getElementById('admin-display-meme-url').value;
            
            // Get after-answer meme type and URL
            const afterMemeType = document.querySelector('.meme-type-btn[data-for="after"].active').getAttribute('data-type');
            const afterMemeUrl = document.getElementById('admin-after-meme-url').value;

            // Validate inputs
            if (!levelId) {
                showModal("Please select a level first!");
                return;
            }
            
            if (!questionText || !option1 || !option2 || !option3 || !option4 || !displayMemeUrl || !afterMemeUrl) {
                showModal("Please fill in all fields!");
                return;
            }

            // Create new question object
            const newQuestion = {
                question: questionText,
                options: [option1, option2, option3, option4],
                correct: 0,
                displayMeme: {
                    type: displayMemeType,
                    url: displayMemeUrl
                },
                afterMeme: {
                    type: afterMemeType,
                    url: afterMemeUrl
                }
            };

            // Add to questions
            if (!quizData.questions[levelId]) {
                quizData.questions[levelId] = [];
            }
            quizData.questions[levelId].push(newQuestion);

            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));

            // Reset the form
            resetAdminForm();

            // Update UI
            updateLevelButtons();
            updateLevelList();
            updateStartMessage();
            
            showModal(`Question added to level! The correct answer will be randomly positioned.`);
        }

        function resetQuestions() {
            if (confirm("Are you sure you want to reset all questions? This cannot be undone.")) {
                quizData.questions = {};
                localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
                
                // Update UI
                updateLevelButtons();
                updateLevelList();
                updateStartMessage();
                
                showModal("All questions have been reset!");
            }
        }

        function viewQuestions() {
            let message = "Current Questions:\n\n";
            
            for (const levelId in quizData.questions) {
                const level = quizData.levels.find(l => l.id === levelId);
                const levelName = level ? level.name : levelId;
                
                message += `--- ${levelName.toUpperCase()} (${quizData.questions[levelId].length} questions) ---\n`;
                
                if (quizData.questions[levelId].length === 0) {
                    message += "No questions yet\n\n";
                } else {
                    quizData.questions[levelId].forEach((q, i) => {
                        message += `${i+1}. ${q.question}\n`;
                        message += `   Correct Answer: ${q.options[0]}\n\n`;
                    });
                    message += "\n";
                }
            }
            
            alert(message);
        }

        function exportQuizData() {
            const dataStr = JSON.stringify(quizData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'meme-quiz-data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function importQuizData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate the imported data structure
                    if (importedData && 
                        importedData.levels !== undefined && 
                        importedData.questions !== undefined) {
                        
                        if (confirm("Importing quiz data will replace your current data. Continue?")) {
                            quizData = importedData;
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
                            
                            // Update UI
                            updateLevelButtons();
                            updateLevelSelect();
                            updateLevelList();
                            updateStartMessage();
                            
                            showModal("Quiz data imported successfully!");
                        }
                    } else {
                        showModal("Invalid quiz data format. Please import a valid JSON file.");
                    }
                } catch (error) {
                    showModal("Error parsing JSON file. Please make sure it's a valid quiz data file.");
                }
            };
            reader.readAsText(file);
            
            // Reset the file input
            event.target.value = '';
        }

        // Helper function to convert hex color to RGB
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : {r: 0, g: 0, b: 0};
        }

        // Initialize the quiz
        initQuiz();
    </script>
</body>
</html>
